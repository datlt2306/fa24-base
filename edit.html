<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
            crossorigin="anonymous"
        />
    </head>
    <body>
        <div class="container py-5">
            <form id="form" class="w-50 m-auto">
                <h2>Thêm sản phẩm</h2>
                <div class="mb-3">
                    <label class="form-label">Tên sản phẩm</label>
                    <input
                        type="text"
                        class="form-control"
                        placeholder="Sản phẩm A"
                        name="name"
                        id="name"
                    />
                </div>
                <div class="mb-3">
                    <label class="form-label">Giá sản phẩm</label>
                    <input
                        type="number"
                        class="form-control"
                        placeholder="$200"
                        name="price"
                        id="price"
                    />
                </div>
                <div class="mb-3">
                    <label class="form-label">Tình trạng</label>
                    <div class="form-check">
                        <input
                            class="form-check-input"
                            type="radio"
                            name="inStock"
                            value="true"
                            id="flexRadioDefault1"
                            checked
                        />
                        <label class="form-check-label" for="flexRadioDefault1">Còn hàng</label>
                    </div>
                    <div class="form-check">
                        <input
                            class="form-check-input"
                            type="radio"
                            name="inStock"
                            value="false"
                            id="flexRadioDefault2"
                        />
                        <label class="form-check-label" for="flexRadioDefault2">Hết hàng</label>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Ảnh sản phẩm</label>
                    <input type="text" class="form-control" name="imageUrl" id="imageUrl" />
                </div>
                <div class="mb-3">
                    <label class="form-label">Mô tả sản phẩm</label>
                    <textarea
                        name="description"
                        class="form-control"
                        rows="4"
                        id="description"
                    ></textarea>
                </div>
                <div class="mb-3">
                    <button class="btn btn-primary" type="submit">Thêm mới</button>
                </div>
            </form>
        </div>

        <script>
            const productId = new URLSearchParams(window.location.search).get("id");
            const validateForm = ({ name, price, imageUrl, description }) => {
                if (!name) {
                    alert("Vui lòng nhập tên sản phẩm");
                    return false;
                }

                if (!price || isNaN(price) || price <= 0) {
                    alert("Vui lòng nhập giá sản phẩm hợp lệ");
                    return false;
                }

                if (!imageUrl) {
                    alert("Vui lòng nhập URL ảnh sản phẩm");
                    return false;
                }

                if (!description) {
                    alert("Vui lòng nhập mô tả sản phẩm");
                    return false;
                }

                return true;
            };

            const loadProductData = async (id) => {
                try {
                    const response = await fetch(`http://localhost:3000/products/${id}`);
                    const product = await response.json();

                    document.querySelector("#name").value = product.name;
                    document.querySelector("#price").value = product.price;
                    document.querySelector(
                        `input[name="inStock"][value="${product.inStock}"]`
                    ).checked = true;
                    document.querySelector("#imageUrl").value = product.imageUrl;
                    document.querySelector("#description").value = product.description;
                } catch (error) {
                    console.error("Failed to load product data", error);
                }
            };

            document.querySelector("#form").addEventListener("submit", async (e) => {
                e.preventDefault();

                const formData = {
                    name: document.querySelector("#name").value.trim(),
                    price: document.querySelector("#price").value.trim(),
                    inStock:
                        document.querySelector('input[name="inStock"]:checked').value === "true",
                    imageUrl: document.querySelector("#imageUrl").value.trim(),
                    description: document.querySelector("#description").value.trim(),
                };

                if (!validateForm(formData)) {
                    return;
                }

                try {
                    const response = await fetch(`http://localhost:3000/products/${productId}`, {
                        method: "PUT",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(formData),
                    });

                    if (response.ok) {
                        alert("Cập nhật sản phẩm thành công");
                    } else {
                        console.error("Failed to update product");
                    }
                } catch (error) {
                    console.error("Error:", error);
                }
            });
            if (productId) {
                loadProductData(productId);
            }
        </script>
    </body>
</html>
